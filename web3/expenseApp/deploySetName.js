const Tx = require("ethereumjs-tx");
const Web3 = require("web3");

const rpcUrl = "https://ropsten.infura.io/v3/e94d0d07e6d344de8f7bde30a57c0e7b";
const web3 = new Web3(rpcUrl);

const account = "0xF56f6C670278B8A8c7Cab226c01129298596C92A";
const privateKey = "c7bd103101284fffa97af99844e124ee68d562f14803d203586c575498d77f6c";
	
const byteCode = "608060405234801561001057600080fd5b5061058b806100206000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c806317d7de7c146100465780639168aee314610064578063c47f002714610082575b600080fd5b61004e61009e565b60405161005b9190610364565b60405180910390f35b61006c610130565b6040516100799190610364565b60405180910390f35b61009c600480360381019061009791906102c7565b6101a2565b005b6060600080546100ad9061045a565b80601f01602080910402602001604051908101604052809291908181526020018280546100d99061045a565b80156101265780601f106100fb57610100808354040283529160200191610126565b820191906000526020600020905b81548152906001019060200180831161010957829003601f168201915b5050505050905090565b60607f0bb563d6789cea5d754d1b7f85bfebdfe7a1a86e2e0ffccfb8a6bbdb07826ae260405161015f90610386565b60405180910390a16040518060400160405280601c81526020017f746869732069732061206576656e74666972652066756e6374696f6e00000000815250905090565b80600090805190602001906101b89291906101bc565b5050565b8280546101c89061045a565b90600052602060002090601f0160209004810192826101ea5760008555610231565b82601f1061020357805160ff1916838001178555610231565b82800160010185558215610231579182015b82811115610230578251825591602001919060010190610215565b5b50905061023e9190610242565b5090565b5b8082111561025b576000816000905550600101610243565b5090565b600061027261026d846103cb565b6103a6565b90508281526020810184848401111561028a57600080fd5b610295848285610418565b509392505050565b600082601f8301126102ae57600080fd5b81356102be84826020860161025f565b91505092915050565b6000602082840312156102d957600080fd5b600082013567ffffffffffffffff8111156102f357600080fd5b6102ff8482850161029d565b91505092915050565b6000610313826103fc565b61031d8185610407565b935061032d818560208601610427565b6103368161051b565b840191505092915050565b600061034e601583610407565b91506103598261052c565b602082019050919050565b6000602082019050818103600083015261037e8184610308565b905092915050565b6000602082019050818103600083015261039f81610341565b9050919050565b60006103b06103c1565b90506103bc828261048c565b919050565b6000604051905090565b600067ffffffffffffffff8211156103e6576103e56104ec565b5b6103ef8261051b565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b82818337600083830152505050565b60005b8381101561044557808201518184015260208101905061042a565b83811115610454576000848401525b50505050565b6000600282049050600182168061047257607f821691505b60208210811415610486576104856104bd565b5b50919050565b6104958261051b565b810181811067ffffffffffffffff821117156104b4576104b36104ec565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b7f6920616d20666972696e67206d79206576656e7420000000000000000000000060008201525056fea2646970667358221220571b11dab54eca157c5bf0b0076886b9e2659de9daf6990232158b8dd37ad5b664736f6c63430008040033";

const privateKeyBuffer = Buffer.from(privateKey, 'hex');
const byteCodeBuffer = Buffer.from(byteCode, "hex");

web3.eth.getTransactionCount(account, (err, txCount) => {
    const txObject = {
        nonce: web3.utils.toHex(txCount),
        gasLimit: web3.utils.toHex(800000),
        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),
        data: byteCodeBuffer
    };
    
    const tx = new Tx.Transaction(txObject, {chain: "ropsten"});
    tx.sign(privateKeyBuffer);
    const serializeTx = tx.serialize();
    const raw = "0x" + serializeTx.toString("hex");
    console.log("Object was ", txObject);
    web3.eth.sendSignedTransaction(raw, (err, txHash) => {
        if(err) {
            console.log("Error => ", err);
        } else {
            console.log("txHas => ", txHash);
        }
    }).then(receipt => {
        console.log(receipt);
        console.log(receipt.contractAddress);
    });
});